# è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆobserver patternï¼‰

æ —å­ ğŸŒ°
æˆ‘æ¥å…¬å¸é¢è¯•çš„æ—¶å€™ï¼Œå®Œäº‹ä¹‹åæ¯ä¸ªé¢è¯•å®˜éƒ½ä¼šå¯¹æˆ‘è¯´ï¼šâ€œè¯·ç•™ä¸‹ä½ çš„è”ç³»æ–¹å¼ï¼Œ æœ‰æ¶ˆæ¯æˆ‘ä»¬ä¼šé€šçŸ¥ä½ â€ã€‚ åœ¨è¿™é‡Œ â€œæˆ‘â€ æ˜¯è®¢é˜…è€…ï¼Œ é¢è¯•å®˜æ˜¯å‘å¸ƒè€…ã€‚æ‰€ä»¥æˆ‘ä¸ç”¨æ¯å¤©æˆ–è€…æ¯å°æ—¶éƒ½å»è¯¢é—®é¢è¯•ç»“æœï¼Œé€šè®¯çš„ä¸»åŠ¨æƒæŒæ¡åœ¨äº†é¢è¯•å®˜æ‰‹ä¸Šã€‚è€Œæˆ‘åªéœ€è¦æä¾›ä¸€ä¸ªè”ç³»æ–¹å¼ã€‚

ä¼˜åŠ¿
1. æ–¹ä¾¿æ¨¡å—ä¹‹é—´çš„è§£è€¦


```js
class Observer {
  constructor() {
    this.handles = {};
    this.on = this._on;
    this.fire = this._fire;
    this.one = this._one;
    this.remove = this._remove;
  }

  _on(key, callback) {
    if (!this.handles[key]) {
      this.handles[key] = [];
    }
    this.handles[key].push(callback);
  }

  _fire() {
    const key = Array.prototype.shift.call(arguments);
    const stack = this.handles[key]
      ? this.handles[key]
      : (this.handles[key] = []);
    for (let i = 0; i < stack.length; i += 1) {
      const fn = stack[i];
      fn.apply(this, arguments);
    }
  }

  _one(key, eventfn) {
    this._remove(key);
    this._on(key, eventfn);
  }

  _remove(key) {
    if (this.handles[key] && this.handles[key].length) {
      this.handles[key].length = 0;
    }
  }
}
const watchTv = new Observer();
// Add multiple listener
watchTv.on("play", function(data) {
  console.log("data1", data);
});
watchTv.on("play", function(data) {
  console.log("data2", data);
});
watchTv.fire("play", { data: "æ—ºè§’å¡é—¨1" });
watchTv.remove("play");

//Add once time listener(only show data2)
watchTv.one("play", function(data) {
  console.log("data1", data);
});
watchTv.one("play", function(data) {
  console.log("data2", data);
});
watchTv.fire("play", { data: "ä½ çš„åå­—" });

//Remove target
watchTv.remove("play");
console.log(watchTv.handles); // {play: []}
```
![codepen](https://codepen.io/jackzong/pen/jONRJwM?editors=0010)